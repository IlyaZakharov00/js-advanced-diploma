!function(){"use strict";var e={1402:function(e,t,r){var n=r(8081),a=r.n(n),i=r(3645),s=r.n(i),o=r(1667),l=r.n(o),c=new URL(r(3523),r.b),h=new URL(r(8349),r.b),d=new URL(r(137),r.b),u=new URL(r(2024),r.b),m=new URL(r(3177),r.b),p=new URL(r(5324),r.b),f=new URL(r(8896),r.b),g=new URL(r(1034),r.b),b=new URL(r(9980),r.b),v=new URL(r(9265),r.b),y=new URL(r(2830),r.b),w=new URL(r(3303),r.b),S=new URL(r(1227),r.b),P=new URL(r(815),r.b),x=new URL(r(4263),r.b),L=new URL(r(5350),r.b),k=new URL(r(1692),r.b),T=new URL(r(4832),r.b),C=new URL(r(6639),r.b),M=new URL(r(1530),r.b),E=new URL(r(2109),r.b),U=new URL(r(4609),r.b),I=new URL(r(3967),r.b),z=new URL(r(5491),r.b),R=new URL(r(9754),r.b),B=new URL(r(5237),r.b),A=new URL(r(2608),r.b),W=new URL(r(1947),r.b),G=new URL(r(6266),r.b),O=new URL(r(8589),r.b),q=new URL(r(8757),r.b),D=new URL(r(2110),r.b),$=new URL(r(3636),r.b),N=new URL(r(8299),r.b),j=new URL(r(6136),r.b),H=new URL(r(9618),r.b),Z=new URL(r(3010),r.b),_=new URL(r(9937),r.b),F=new URL(r(9030),r.b),J=new URL(r(7345),r.b),Q=new URL(r(5195),r.b),K=new URL(r(5153),r.b),V=new URL(r(8269),r.b),X=new URL(r(5316),r.b),Y=s()(a()),ee=l()(c),te=l()(h),re=l()(d),ne=l()(u),ae=l()(m),ie=l()(p),se=l()(f),oe=l()(g),le=l()(b),ce=l()(v),he=l()(y),de=l()(w),ue=l()(S),me=l()(P),pe=l()(x),fe=l()(L),ge=l()(k),be=l()(T),ve=l()(C),ye=l()(M),we=l()(E),Se=l()(U),Pe=l()(I),xe=l()(z),Le=l()(R),ke=l()(B),Te=l()(A),Ce=l()(W),Me=l()(G),Ee=l()(O),Ue=l()(q),Ie=l()(D),ze=l()($),Re=l()(N),Be=l()(j),Ae=l()(H),We=l()(Z),Ge=l()(_),Oe=l()(F),qe=l()(J),De=l()(Q),$e=l()(K),Ne=l()(V),je=l()(X);Y.push([e.id,":root {\r\n  --cell-size: 64px;\r\n}\r\n\r\nhtml, body {\r\n  height: 100%;\r\n  margin: 0;\r\n}\r\n\r\nbody {\r\n  background: #000;\r\n  font-size: 16px;\r\n}\r\n\r\n.btn {\r\n  display: inline-block;\r\n  font-weight: 400;\r\n  color: #212529;\r\n  background-color: #f8f9fa;\r\n  text-align: center;\r\n  vertical-align: middle;\r\n  padding: .375rem .75rem;\r\n  font-size: 1rem;\r\n  line-height: 1.5;\r\n  border-radius: .25rem;\r\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\r\n  border: none;\r\n}\r\n\r\n.controls {\r\n  text-align: center;\r\n  margin: 50px 0;\r\n}\r\n\r\n.board-container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.board {\r\n  display: grid;\r\n  grid-template-columns: repeat(8, 1fr);\r\n  grid-column-gap: 2px;\r\n  grid-row-gap: 2px;\r\n}\r\n\r\n.cell {\r\n  position: relative;\r\n}\r\n\r\n.cell.selected::before {\r\n  content: '';\r\n  display: block;\r\n  border: 4px;\r\n  border-radius: 32px;\r\n  box-sizing: border-box;\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  opacity: 0.9;\r\n  position: absolute;\r\n}\r\n\r\n.cell.selected-yellow::before {\r\n  border-color: #ff0;\r\n  border-style: solid;\r\n}\r\n\r\n.cell.selected-green::before {\r\n  border-color: #0f0;\r\n  border-style: dashed;\r\n}\r\n\r\n.cell.selected-red::before {\r\n  border-color: #f00;\r\n  border-style: dashed;\r\n}\r\n\r\n.board.prairie {\r\n  --map-tile-top-left-url: url("+ee+");\r\n  --map-tile-top-url: url("+te+");\r\n  --map-tile-top-right-url: url("+re+");\r\n  --map-tile-bottom-left-url: url("+ne+");\r\n  --map-tile-bottom-url: url("+ae+");\r\n  --map-tile-bottom-right-url: url("+ie+");\r\n  --map-tile-left-url: url("+se+");\r\n  --map-tile-right-url: url("+oe+");\r\n  --map-tile-center-url: url("+le+");\r\n}\r\n\r\n.board.desert {\r\n  --map-tile-top-left-url: url("+ce+");\r\n  --map-tile-top-url: url("+he+");\r\n  --map-tile-top-right-url: url("+de+");\r\n  --map-tile-bottom-left-url: url("+ue+");\r\n  --map-tile-bottom-url: url("+me+");\r\n  --map-tile-bottom-right-url: url("+pe+");\r\n  --map-tile-left-url: url("+fe+");\r\n  --map-tile-right-url: url("+ge+");\r\n  --map-tile-center-url: url("+be+");\r\n}\r\n\r\n.board.arctic {\r\n  --map-tile-top-left-url: url("+ve+");\r\n  --map-tile-top-url: url("+ye+");\r\n  --map-tile-top-right-url: url("+we+");\r\n  --map-tile-bottom-left-url: url("+Se+");\r\n  --map-tile-bottom-url: url("+Pe+");\r\n  --map-tile-bottom-right-url: url("+xe+");\r\n  --map-tile-left-url: url("+Le+");\r\n  --map-tile-right-url: url("+ke+");\r\n  --map-tile-center-url: url("+Te+");\r\n}\r\n\r\n.board.mountain {\r\n  --map-tile-top-left-url: url("+Ce+");\r\n  --map-tile-top-url: url("+Me+");\r\n  --map-tile-top-right-url: url("+Ee+");\r\n  --map-tile-bottom-left-url: url("+Ue+");\r\n  --map-tile-bottom-url: url("+Ie+");\r\n  --map-tile-bottom-right-url: url("+ze+");\r\n  --map-tile-left-url: url("+Re+");\r\n  --map-tile-right-url: url("+Be+");\r\n  --map-tile-center-url: url("+Ae+");\r\n}\r\n\r\n.map-tile {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n}\r\n\r\n.map-tile-top-left {\r\n  background: var(--map-tile-top-left-url);\r\n}\r\n\r\n.map-tile-top {\r\n  background: var(--map-tile-top-url);\r\n}\r\n\r\n.map-tile-top-right {\r\n  background: var(--map-tile-top-right-url);\r\n}\r\n\r\n.map-tile-bottom-left {\r\n  background: var(--map-tile-bottom-left-url);\r\n}\r\n\r\n.map-tile-bottom {\r\n  background: var(--map-tile-bottom-url);\r\n}\r\n\r\n.map-tile-bottom-right {\r\n  background: var(--map-tile-bottom-right-url);\r\n}\r\n\r\n.map-tile-left {\r\n  background: var(--map-tile-left-url);\r\n}\r\n\r\n.map-tile-right {\r\n  background: var(--map-tile-right-url);\r\n}\r\n\r\n.map-tile-center {\r\n  background: var(--map-tile-center-url);\r\n}\r\n\r\n.character {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  position: absolute;\r\n  z-index: 99;\r\n}\r\n\r\n.character.generic {\r\n  background: url("+We+");\r\n}\r\n\r\n.character.bowman {\r\n  background: url("+Ge+");\r\n}\r\n\r\n.character.daemon {\r\n  background: url("+Oe+");\r\n}\r\n\r\n.character.magician {\r\n  background: url("+qe+");\r\n}\r\n\r\n.character.swordsman {\r\n  background: url("+De+");\r\n}\r\n\r\n.character.undead {\r\n  background: url("+$e+");\r\n}\r\n\r\n.character.vampire {\r\n  background: url("+Ne+");\r\n}\r\n\r\n.character.zombie {\r\n  background: url("+je+");\r\n}\r\n\r\n.health-level {\r\n  top: 2px;\r\n  left: 7px;\r\n  position: absolute;\r\n  width: 50px;\r\n  height: 4px;\r\n  background: #000;\r\n}\r\n\r\n.health-level-indicator {\r\n  height: 4px;\r\n}\r\n\r\n.health-level-indicator-high {\r\n  background: #0f0;\r\n}\r\n\r\n.health-level-indicator-normal {\r\n  background: #ff0;\r\n}\r\n\r\n.health-level-indicator-critical {\r\n  background: #f00;\r\n}\r\n\r\n.damage {\r\n  position: absolute;\r\n  width: var(--cell-size);\r\n  text-align: center;\r\n  z-index: 999;\r\n  color: #f00;\r\n  font-weight: bold;\r\n  animation: 500ms fade ease-out;\r\n}\r\n\r\n@keyframes fade {\r\n  from {\r\n    opacity: 0;\r\n    top: calc(var(--cell-size) * 0.5);\r\n    font-size: 1rem;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    top: -20px;\r\n    font-size: 1.5rem;\r\n  }\r\n}\r\n",""]),t.Z=Y},3645:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,a,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(n)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);n&&s[h[0]]||(void 0!==i&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=i),r&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=r):h[2]=r),a&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=a):h[4]="".concat(a)),t.push(h))}},t}},1667:function(e){e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},8081:function(e){e.exports=function(e){return e[1]}},3379:function(e){var t=[];function r(e){for(var r=-1,n=0;n<t.length;n++)if(t[n].identifier===e){r=n;break}return r}function n(e,n){for(var i={},s=[],o=0;o<e.length;o++){var l=e[o],c=n.base?l[0]+n.base:l[0],h=i[c]||0,d="".concat(c," ").concat(h);i[c]=h+1;var u=r(d),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(m);else{var p=a(m,n);n.byIndex=o,t.splice(o,0,{identifier:d,updater:p,references:1})}s.push(d)}return s}function a(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,a){var i=n(e=e||[],a=a||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var o=r(i[s]);t[o].references--}for(var l=n(e,a),c=0;c<i.length;c++){var h=r(i[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}i=l}}},569:function(e){var t={};e.exports=function(e,r){var n=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},9216:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:function(e,t,r){e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},7795:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var a=void 0!==r.layer;a&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,a&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var i=r.sourceMap;i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},4609:function(e,t,r){e.exports=r.p+"b27323cf850ed820855c.png"},5491:function(e,t,r){e.exports=r.p+"ac9d74f57639792774bc.png"},3967:function(e,t,r){e.exports=r.p+"63aae58e4690953a3857.png"},2608:function(e,t,r){e.exports=r.p+"246277b8ca590816b3e8.png"},9754:function(e,t,r){e.exports=r.p+"3d9503e0a850fda86f82.png"},5237:function(e,t,r){e.exports=r.p+"22e7c5ede3f747cbe27a.png"},6639:function(e,t,r){e.exports=r.p+"eab6a2cc5e89a4dd8e3f.png"},2109:function(e,t,r){e.exports=r.p+"d31d84c693f649766aee.png"},1530:function(e,t,r){e.exports=r.p+"e0aa3daf6d08c62c96d9.png"},9937:function(e,t,r){e.exports=r.p+"cec542854b228e61547a.png"},9030:function(e,t,r){e.exports=r.p+"cf170a9fea1051b7424a.png"},3010:function(e,t,r){e.exports=r.p+"0a77fc47d727eab6fd39.png"},7345:function(e,t,r){e.exports=r.p+"c0fa2b75539f94144dc4.png"},5195:function(e,t,r){e.exports=r.p+"2007ec00c1d9f997e704.png"},5153:function(e,t,r){e.exports=r.p+"f5c75398bcb5931f9f3c.png"},8269:function(e,t,r){e.exports=r.p+"bf0ed0dca1d1e6091d42.png"},5316:function(e,t,r){e.exports=r.p+"296dfeac15e2377fc1dc.png"},1227:function(e,t,r){e.exports=r.p+"13edb269e39172ddd74f.png"},4263:function(e,t,r){e.exports=r.p+"5cf9c17d6a1ea7106a6c.png"},815:function(e,t,r){e.exports=r.p+"f1703771380a9959d979.png"},4832:function(e,t,r){e.exports=r.p+"51e2a5de56bd631452fe.png"},5350:function(e,t,r){e.exports=r.p+"eb1f6e4f87b977012684.png"},1692:function(e,t,r){e.exports=r.p+"2c19971f327b288278bb.png"},9265:function(e,t,r){e.exports=r.p+"258d884122fabfc2f312.png"},3303:function(e,t,r){e.exports=r.p+"2f1e1970c2c20cf3a8d5.png"},2830:function(e,t,r){e.exports=r.p+"dc3f97e7bbcd5ea1ded9.png"},8757:function(e,t,r){e.exports=r.p+"1d70f1dab2dd418c3612.png"},3636:function(e,t,r){e.exports=r.p+"6bacb8e25ed9ecf726bf.png"},2110:function(e,t,r){e.exports=r.p+"f462d2ed6eedca1e4fd9.png"},9618:function(e,t,r){e.exports=r.p+"6f6f7c09bde970b2e41b.png"},8299:function(e,t,r){e.exports=r.p+"c75f062dddba6e98fdc6.png"},6136:function(e,t,r){e.exports=r.p+"26fdc25019c24e87f11a.png"},1947:function(e,t,r){e.exports=r.p+"ef1b0ea8c4e545d9aadc.png"},8589:function(e,t,r){e.exports=r.p+"a1d2321024649b9d8f5f.png"},6266:function(e,t,r){e.exports=r.p+"8b928c3eb136543e573a.png"},2024:function(e,t,r){e.exports=r.p+"26b5f224d8750119922d.png"},5324:function(e,t,r){e.exports=r.p+"2429af6d3a5796e3c34b.png"},3177:function(e,t,r){e.exports=r.p+"07d5e8127645225478b6.png"},9980:function(e,t,r){e.exports=r.p+"0089a610e6611f679b50.png"},8896:function(e,t,r){e.exports=r.p+"546abb060a0837550fd1.png"},1034:function(e,t,r){e.exports=r.p+"6a84ae91f5d985ddc9ee.png"},3523:function(e,t,r){e.exports=r.p+"46d63299c3420c030b4e.png"},137:function(e,t,r){e.exports=r.p+"0ac7f8258ec7166dc957.png"},8349:function(e,t,r){e.exports=r.p+"946aeb948db6313f1d85.png"}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={id:n,exports:{}};return e[n](i,i.exports,r),i.exports}r.m=e,r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var a=n.length-1;a>-1&&!e;)e=n[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e}(),r.b=document.baseURI||self.location.href,r.nc=void 0,function(){var e=r(3379),t=r.n(e),n=r(7795),a=r.n(n),i=r(569),s=r.n(i),o=r(3565),l=r.n(o),c=r(9216),h=r.n(c),d=r(4589),u=r.n(d),m=r(1402),p={};function f(e,t){switch(!0){case 0===e:return"top-left";case e===t-1:return"top-right";case e===t*(t-1):return"bottom-left";case e===t*t-1:return"bottom-right";case e>0&&e<t:return"top";case e%t==0:return"left";case(e+1)%t==0:return"right";case e>t*(t-1)&&e<t*t-1:return"bottom";default:return"center"}}p.styleTagTransform=u(),p.setAttributes=l(),p.insert=s().bind(null,"head"),p.domAPI=a(),p.insertStyleElement=h(),t()(m.Z,p),m.Z&&m.Z.locals&&m.Z.locals;class g{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(e){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(e=>this.onNewGameClick(e))),this.saveGameEl.addEventListener("click",(e=>this.onSaveGameClick(e))),this.loadGameEl.addEventListener("click",(e=>this.onLoadGameClick(e))),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(let e=0;e<this.boardSize**2;e+=1){const t=document.createElement("div");t.classList.add("cell","map-tile",`map-tile-${f(e,this.boardSize)}`),t.addEventListener("mouseenter",(e=>this.onCellEnter(e))),t.addEventListener("mouseleave",(e=>this.onCellLeave(e))),t.addEventListener("click",(e=>this.onCellClick(e))),this.boardEl.appendChild(t)}this.cells=Array.from(this.boardEl.children)}redrawPositions(e){for(const e of this.cells)e.innerHTML="";for(const r of e){const e=this.boardEl.children[r.position],n=document.createElement("div");n.classList.add("character",r.character.type);const a=document.createElement("div");a.classList.add("health-level");const i=document.createElement("div");i.classList.add("health-level-indicator","health-level-indicator-"+((t=r.character.health)<15?"critical":t<50?"normal":"high")),i.style.width=`${r.character.health}%`,a.appendChild(i),n.appendChild(a),e.appendChild(n)}var t}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addCellClickListener(e){this.cellClickListeners.push(e)}addNewGameListener(e){this.newGameListeners.push(e)}addSaveGameListener(e){this.saveGameListeners.push(e)}addLoadGameListener(e){this.loadGameListeners.push(e)}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach((e=>e.call(null,t)))}onCellLeave(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach((e=>e.call(null,t)))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((e=>e.call(null,t)))}onNewGameClick(e){e.preventDefault(),this.newGameListeners.forEach((e=>e.call(null)))}onSaveGameClick(e){e.preventDefault(),this.saveGameListeners.forEach((e=>e.call(null)))}onLoadGameClick(e){e.preventDefault(),this.loadGameListeners.forEach((e=>e.call(null)))}static showError(e){alert(e)}static showMessage(e){alert(e)}selectCell(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`)}deselectCell(e){const t=this.cells[e];t.classList.remove(...Array.from(t.classList).filter((e=>e.startsWith("selected"))))}showCellTooltip(e,t){this.cells[t].title=e}hideCellTooltip(e){this.cells[e].title=""}showDamage(e,t){return new Promise((r=>{const n=this.cells[e],a=document.createElement("span");a.textContent=t,a.classList.add("damage"),n.appendChild(a),a.addEventListener("animationend",(()=>{n.removeChild(a),r()}))}))}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}console.log(g);var b={1:"prairie",2:"desert",3:"arctic",4:"mountain"};class v{constructor(){this.members=new Set}add(e){this.members.add(e)}addAll(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach((e=>{this.members.add(e)}))}toArray(){const e=[];return this.members.forEach((t=>e.push(t))),e}delete(e){console.log("Удален",e),this.members.delete(e)}}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0;const n=new v;let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function*(){for(;;){const r=Math.floor(Math.random()*e.length),n=Math.ceil(Math.random()*t);yield new e[r](n)}}()}(e,t);for(let e=0;e<r;e++){let e=a.next().value;n.add(e)}return n.toArray()}console.log(v);class w{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(this.level=e,this.attack=0,this.defence=0,this.health=100,this.type=t,"Character"===new.target.name)throw new Error("Нельзя создавать объекты класса Character")}}console.log(w);class S{constructor(e,t){if(!(e instanceof w))throw new Error("character must be instance of Character or its children");if("number"!=typeof t)throw new Error("position must be a number");this.character=e,this.position=t}}console.log(S);class P{constructor(){this.heroesList=[],this.characterSelected=null,this.permissionMove=!1,this.level=1,this.statistic=[],this.points=0,this.deleteRival=[]}static from(e){return"object"==typeof e?e:null}}function x(){const e=[0,1,8,9,16,17,24,25,32,33,40,41,48,49,56,57],t=[];do{const r=Math.trunc(Math.random()*e.length);t.push(e[r]),e.splice(r,1)}while(1!==e.length);return t}function L(){const e=[6,7,14,15,22,23,30,31,38,39,46,47,54,55,62,63],t=[];do{const r=Math.trunc(Math.random()*e.length);t.push(e[r]),e.splice(r,1)}while(1!==e.length);return t}console.log(P);class k extends w{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bowman"),this.attack=25,this.defence=25}}console.log(k);class T extends w{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"magician"),this.attack=10,this.defence=40}}console.log(T);class C extends w{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"daemon"),this.attack=10,this.defence=10}}console.log(C);class M extends w{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"swordsman"),this.attack=40,this.defence=10}}console.log(M);class E extends w{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"undead"),this.attack=40,this.defence=10}}console.log(E);class U extends w{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vampire"),this.attack=25,this.defence=25}}console.log(U);class I{constructor(e,t){this.gamePlay=e,this.gameState=new P,this.stateService=t,this.userTeam=new v,this.userPositions=[],this.userTeamWithPosition=[],this.enemyTeam=new v,this.enemyPositions=[],this.enemyTeamWithPosition=[]}init(){this.gamePlay.drawUi(b[this.gameState.level]),this.userTeam=y([T,k,M],1,2),this.userPositions=x();for(let e=0;e<this.userTeam.length;e++){let t=new S(this.userTeam[e],this.userPositions[e]);this.userTeamWithPosition.push(t),this.gameState.heroesList.push(t)}this.enemyTeam=y([E,C,U],1,2),this.enemyPositions=L();for(let e=0;e<this.enemyTeam.length;e++){let t=new S(this.enemyTeam[e],this.enemyPositions[e]);this.enemyTeamWithPosition.push(t),this.gameState.heroesList.push(t)}this.gamePlay.redrawPositions([...this.userTeamWithPosition,...this.enemyTeamWithPosition]),this.gamePlay.addCellEnterListener((e=>{this.onCellEnter(e)})),this.gamePlay.addCellClickListener((e=>{this.gamePlay.cells.forEach((e=>e.classList.remove("selected"))),this.onCellClick(e)})),this.gamePlay.addCellLeaveListener((e=>{this.onCellLeave(e)})),this.gamePlay.addNewGameListener((()=>{new I(this.gamePlay,this.stateService).init()})),this.gamePlay.addSaveGameListener((()=>{this.stateService.save(P.from(this.gameState)),null===localStorage.getItem("state")&&g.showMessage("Игра не сохранилась"),g.showMessage("Игра сохранена")})),this.gamePlay.addLoadGameListener((()=>{const e=this.stateService.load();e||g.showError("Отсутствует сохраненная игра"),this.gameState.level=e.level,this.gamePlay.drawUi(b[e.level]),this.gameState.permissionMove=e.permissionMove,this.gameState.heroesList=[],this.gameState.points=e.points,this.gameState.statistic=e.statistic,this.gameState.characterSelected=e.characterSelected,this.userTeam=new v,this.rivalTeam=new v,e.heroesList.forEach((e=>{let t;switch(e.character.type){case"swordsman":t=new M(e.character.level),this.userTeam.addAll([t]);break;case"bowman":t=new k(e.character.level),this.userTeam.addAll([t]);break;case"magician":t=new T(e.character.level),this.userTeam.addAll([t]);break;case"undead":t=new E(e.character.level),this.rivalTeam.addAll([t]);break;case"vampire":t=new U(e.character.level),this.rivalTeam.addAll([t]);break;case"daemon":t=new C(e.character.level),this.rivalTeam.addAll([t])}t.health=e.character.health,this.gameState.heroesList.push(new S(t,e.position))})),this.gamePlay.redrawPositions(this.gameState.heroesList),g.showMessage("Игра загружена")}))}onCellClick(e){if(this.findPersonByIndex(e)){const t=this.findPersonByIndex(e).character;if(t instanceof M||t instanceof k||t instanceof T)this.gameState.characterSelected||this.gameState.permissionMove?(this.gameState.characterSelected=null,this.gameState.permissionMove=!1):(this.gamePlay.selectCell(e),this.gameState.characterSelected=e,this.gameState.permissionMove=!0,this.findBorder(),this.countSquare=this.findCountSquare(e),this.allowIndexsMove=this.calcMove(this.countSquare,e),this.countAttack=this.findAttackSquare(e),this.allowIndexsAttack=this.calcAttack(this.countAttack,e));else if(this.gameState.characterSelected&&!this.allowIndexsAttack.includes(e))return this.gameState.characterSelected=null,void(this.gameState.permissionMove=!1);if(!this.gameState.characterSelected&&this.findEnemyPerson(e)&&g.showError("Нельзя управлять персонажем из команды врага!"),this.findEnemyPerson(e)&&this.gameState.permissionMove&&this.gameState.characterSelected&&this.allowIndexsAttack.includes(e)){let t=this.findPersonByIndex(e),r=this.findPersonByIndex(this.gameState.characterSelected),n=Math.max(r.character.attack-t.character.defence,.1*r.character.attack);this.gamePlay.showDamage(e,n).then((()=>{if(t.character.health-=n,this.gamePlay.redrawPositions(this.gameState.heroesList),t.character.health<=0){if(this.enemyTeam.splice(this.enemyTeam.indexOf(t),1),this.enemyTeamWithPosition.splice(this.enemyTeamWithPosition.indexOf(t),1),this.gameState.heroesList.splice(this.gameState.heroesList.indexOf(t),1),this.gamePlay.redrawPositions(this.gameState.heroesList),1==this.enemyTeam.length){g.showMessage("ВНИМАНИЕ, ВКЛЮЧЕН СУПЕР-РЕЖИМ!"),this.gamePlay.redrawPositions(this.gameState.heroesList);let e=this.enemyTeamWithPosition[0].position,t=this.findPersonByIndex(e);t.character.attack+=.25*t.character.attack,t.character.health+=.25*t.character.health,this.gamePlay.redrawPositions(this.gameState.heroesList)}if(0===this.enemyTeam.length){if(0===this.enemyTeam.length&&5===this.gameState.level)return void g.showMessage("Вы победили! Игра окончена!");this.nextLevel()}else this.enemyAttackUser(),this.gamePlay.redrawPositions(this.gameState.heroesList)}else this.enemyAttackUser()})),this.gameState.characterSelected=null,this.gameState.permissionMove=!1}}!this.findPersonByIndex(e)&&this.gameState.permissionMove&&this.allowIndexsMove.includes(e)?(this.userMoveClickIndex(e),this.gamePlay.cells.forEach((e=>e.classList.remove("selected-green")))):this.gameState.characterSelected&&(this.findPersonByIndex(e)||(this.gameState.characterSelected=null,this.gameState.permissionMove=!1))}onCellEnter(e){if(this.findPersonByIndex(e)){const t=this.findPersonByIndex(e).character,r=`🎖${t.level}⚔${t.attack}🛡${t.defence}❤${t.health}`;this.gamePlay.showCellTooltip(r,e)}this.findUserPerson(e)&&this.gamePlay.setCursor("pointer"),null!==this.gameState.characterSelected&&!this.findPersonByIndex(e)&&this.allowIndexsMove.includes(e)&&this.gameState.permissionMove&&(this.gamePlay.setCursor("pointer"),this.gamePlay.selectCell(e,"green"),this.gameState.permissionMove=!0),this.gameState.characterSelected&&this.findEnemyPerson(e)&&this.allowIndexsAttack.includes(e)&&(this.gamePlay.setCursor("crosshair"),this.gamePlay.selectCell(e,"red")),!this.gameState.characterSelected||this.allowIndexsMove.includes(e)||this.findPersonByIndex(e)||this.gamePlay.setCursor("not-allowed")}onCellLeave(e){this.gamePlay.cells.forEach((e=>e.classList.remove("selected-red"))),this.gamePlay.cells.forEach((e=>e.classList.remove("selected-green"))),this.gamePlay.hideCellTooltip(e),this.gamePlay.setCursor("auto")}findPersonByIndex(e){return this.gameState.heroesList.find((t=>t.position===e))}findUserPerson(e){return this.userTeamWithPosition.find((t=>t.position===e))}findEnemyPerson(e){return this.enemyTeamWithPosition.find((t=>t.position===e))}findtSelectedCharacter(){return this.gameState.heroesList.find((e=>e.position===this.gameState.characterSelected))}findBorder(){this.leftBorder=[],this.rightBorder=[];for(let e=0,t=this.gamePlay.boardSize-1;this.leftBorder.length<this.gamePlay.boardSize;e+=this.gamePlay.boardSize,t+=this.gamePlay.boardSize)this.leftBorder.push(e),this.rightBorder.push(t);this.upBorder=[],this.downBorder=[];for(let e=0,t=this.gamePlay.boardSize*this.gamePlay.boardSize-1;this.upBorder.length<this.gamePlay.boardSize;e+=1,t-=1)this.upBorder.push(e),this.downBorder.push(t)}findCountSquare(e){const t=this.findPersonByIndex(e);return"swordsman"==t.character.type||"undead"==t.character.type?4:"bowman"==t.character.type||"vampire"==t.character.type?2:"magician"==t.character.type||"daemon"==t.character.type?1:void 0}calcMove(e,t){this.allowIndexsMove=[];let r=[],n=[],a=[],i=[];for(let r=1;r<=e;r++){if(!this.upBorder.includes(t)){const e=t-this.gamePlay.boardSize*r;e>=0&&(this.allowIndexsMove.push(t-this.gamePlay.boardSize*r),a.push(e))}if(!this.downBorder.includes(t)){const e=t+this.gamePlay.boardSize*r;e<this.gamePlay.boardSize**2&&(this.allowIndexsMove.push(t+this.gamePlay.boardSize*r),i.push(e))}}for(let n=1;n<=e&&!this.rightBorder.includes(t);n++){this.allowIndexsMove.push(t+n),r.push(t+n);let e=t+(this.gamePlay.boardSize*n+n);e<this.gamePlay.boardSize**2&&(this.allowIndexsMove.push(e),r.push(e));let a=t-(this.gamePlay.boardSize*n-n);if(a>=0&&(this.allowIndexsMove.push(a),r.push(a)),this.rightBorder.includes(t+n))break}for(let r=1;r<=e&&!this.leftBorder.includes(t);r++){this.allowIndexsMove.push(t-r),n.push(t-r);let e=t+(this.gamePlay.boardSize*r-r);e<this.gamePlay.boardSize**2&&(this.allowIndexsMove.push(e),n.push(e));let a=t-(this.gamePlay.boardSize*r+r);if(a>=0&&(this.allowIndexsMove.push(a),n.push(a)),this.leftBorder.includes(t-r))break}return this.allowIndexsMove}userMoveClickIndex(e){this.findtSelectedCharacter()?(this.findtSelectedCharacter().position=e,this.gamePlay.deselectCell(this.gameState.characterSelected),this.gamePlay.redrawPositions(this.gameState.heroesList),this.gameState.characterSelected=null,this.gameState.permissionMove=!1,this.enemyAttackUser()):(this.gameState.characterSelected.position=e,this.gamePlay.redrawPositions(this.gameState.heroesList),this.gameState.characterSelected=null,this.gameState.permissionMove=!1)}findAttackSquare(e){const t=this.findPersonByIndex(e);return"swordsman"==t.character.type||"undead"==t.character.type?1:"bowman"==t.character.type||"vampire"==t.character.type?2:"magician"==t.character.type||"daemon"==t.character.type?4:void 0}calcAttack(e,t){this.allowIndexsAttack=[];let r=[],n=[],a=[],i=[];for(let r=1;r<=e;r++){if(!this.upBorder.includes(t)){const e=t-this.gamePlay.boardSize*r;e>=0&&(this.allowIndexsAttack.push(t-this.gamePlay.boardSize*r),a.push(e))}if(!this.downBorder.includes(t)){const e=t+this.gamePlay.boardSize*r;e<this.gamePlay.boardSize**2&&(this.allowIndexsAttack.push(t+this.gamePlay.boardSize*r),i.push(e))}}for(let n=1;n<=e&&!this.rightBorder.includes(t);n++){let a=t+n,i=t-this.gamePlay.boardSize*n,s=t+this.gamePlay.boardSize*n;if(this.leftBorder.includes(a)||(this.allowIndexsAttack.push(a),r.push(a)),i<0)console.log("linup < 0");else for(let t=1;t<=e;t++)this.leftBorder.includes(i+t)||(this.allowIndexsAttack.push(i+t),r.push(i+t));if(s>=this.gamePlay.boardSize**2)console.log("lineDown >= this.gamePlay.boardSize ** 2");else for(let t=1;t<=e;t++)!this.leftBorder.includes(s+t)&&s+t<this.gamePlay.boardSize**2&&(this.allowIndexsAttack.push(s+t),r.push(s+t))}for(let r=1;r<=e&&!this.leftBorder.includes(t);r++){let a=t-r,i=t-this.gamePlay.boardSize*r,s=t+this.gamePlay.boardSize*r;if(this.rightBorder.includes(a)||(this.allowIndexsAttack.push(a),n.push(a)),i<0)console.log("lineUp < 0");else for(let t=1;t<=e;t++)this.rightBorder.includes(i-t)||(this.allowIndexsAttack.push(i-t),n.push(i-t));if(s>=this.gamePlay.boardSize**2)console.log("lineDown >= this.gamePlay.boardSize ** 2");else for(let t=1;t<=e;t++)!this.rightBorder.includes(s-t)&&s-t>0&&(this.allowIndexsAttack.push(s-t),n.push(s-t))}return this.allowIndexsAttack}enemyAttackUser(){if(this.gameState.permissionMove)return;let e,t,r,n,a=null,i=null;if(0!==this.enemyTeamWithPosition.length&&0!==this.userTeamWithPosition.length)if(this.enemyTeamWithPosition.forEach((s=>{e=this.findAttackSquare(s.position),t=this.calcAttack(e,s.position),r=this.findCountSquare(s.position),n=this.calcMove(r,s.position),this.userTeamWithPosition.forEach((e=>{t.includes(e.position)&&(a=s,i=e)}))})),i){let e=Math.max(a.character.attack-i.character.defence,.1*a.character.attack);this.gamePlay.showDamage(i.position,e).then((()=>{i.character.health-=e,this.gamePlay.redrawPositions(this.gameState.heroesList),i.character.health<=0&&(this.userTeamWithPosition.splice(this.userTeamWithPosition.indexOf(i),1),this.gameState.heroesList.splice(this.gameState.heroesList.indexOf(i),1),this.gamePlay.redrawPositions(this.gameState.heroesList),0===this.userTeamWithPosition.length&&g.showMessage("Вы проиграли!"))}))}else{this.gameState.characterSelected=this.enemyTeamWithPosition[Math.floor(Math.random()*this.enemyTeamWithPosition.length)];let e=n[Math.floor(Math.random()*n.length)];for(;this.findEnemyPerson(e)&&this.findUserPerson(e);)e=n[Math.floor(Math.random()*n.length)];this.userMoveClickIndex(e)}}levelUP(e){e.health<=50&&(e.attack*=1.3,e.defence*=1.3),e.health+80>100?e.health=100:e.health+=80,e.level++}nextLevel(){this.gameState.level++,g.showMessage(`Уровень ${this.gameState.level} Ваше количество очков ${this.scorePoints()}`),this.gamePlay.drawUi(b[this.gameState.level]);for(const e of this.userTeam)this.levelUP(e);if(2==this.gameState.level){let e=x();for(let t=0;t<this.userTeamWithPosition.length;t++)this.userTeamWithPosition[t].position=e[t];this.enemyTeam=y([E,C,U],1,2),this.enemyPositions=L();for(let e=0;e<this.enemyTeam.length;e++){let t=new S(this.enemyTeam[e],this.enemyPositions[e]);this.enemyTeamWithPosition.push(t),this.gameState.heroesList.push(t)}}if(3==this.gameState.level){let e=x();for(let t=0;t<this.userTeamWithPosition.length;t++)this.userTeamWithPosition[t].position=e[t];this.enemyTeam=y([E,C,U],3,2),this.enemyPositions=L();for(let e=0;e<this.enemyTeam.length;e++){let t=new S(this.enemyTeam[e],this.enemyPositions[e]);this.enemyTeamWithPosition.push(t),this.gameState.heroesList.push(t)}}if(4==this.gameState.level){let e=x();for(let t=0;t<this.userTeamWithPosition.length;t++)this.userTeamWithPosition[t].position=e[t];this.enemyTeam=y([E,C,U],4,2),this.enemyPositions=L();for(let e=0;e<this.enemyTeam.length;e++){let t=new S(this.enemyTeam[e],this.enemyPositions[e]);this.enemyTeamWithPosition.push(t),this.gameState.heroesList.push(t)}}if(5==this.gameState.level){let e=x();for(let t=0;t<this.userTeamWithPosition.length;t++)this.userTeamWithPosition[t].position=e[t];this.enemyTeam=y([E,C,U],5,2),this.enemyPositions=L();for(let e=0;e<this.enemyTeam.length;e++){let t=new S(this.enemyTeam[e],this.enemyPositions[e]);this.enemyTeamWithPosition.push(t),this.gameState.heroesList.push(t)}}this.gamePlay.redrawPositions(this.gameState.heroesList)}scorePoints(){console.log("подсчет очков");let e=0;for(const t of this.userTeam)e+=t.health;return e}}console.log(I);class z{constructor(e){this.storage=e}save(e){this.storage.setItem("state",JSON.stringify(e))}load(){try{return JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state")}}}console.log(z);const R=new g;R.bindToDOM(document.querySelector("#game-container"));const B=new z(localStorage);new I(R,B).init()}()}();